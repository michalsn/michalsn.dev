<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Building a Production-Ready File Handler for CodeIgniter 4 Settings | michalsn</title><meta name=keywords content="codeigniter4,settings"><meta name=description content="While CodeIgniter 4 Settings includes a database-backed handler, I wanted a file-based option that&rsquo;s lightweight, fast, and safe for production use. I&rsquo;ll walk through the challenges of handling concurrency, file locking, and caching, and explain the design choices behind the new FileHandler."><meta name=author content><link rel=canonical href=https://michalsn.dev/posts/building-a-production-ready-file-handler-for-codeigniter-4-settings/><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://michalsn.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://michalsn.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://michalsn.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://michalsn.dev/apple-touch-icon.png><link rel=mask-icon href=https://michalsn.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://michalsn.dev/posts/building-a-production-ready-file-handler-for-codeigniter-4-settings/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=/css/custom.css><script src=/js/custom.js></script><meta property="og:url" content="https://michalsn.dev/posts/building-a-production-ready-file-handler-for-codeigniter-4-settings/"><meta property="og:site_name" content="michalsn"><meta property="og:title" content="Building a Production-Ready File Handler for CodeIgniter 4 Settings"><meta property="og:description" content="While CodeIgniter 4 Settings includes a database-backed handler, I wanted a file-based option that’s lightweight, fast, and safe for production use. I’ll walk through the challenges of handling concurrency, file locking, and caching, and explain the design choices behind the new FileHandler."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-10-29T19:33:19+02:00"><meta property="article:modified_time" content="2025-10-29T19:33:19+02:00"><meta property="article:tag" content="Codeigniter4"><meta property="article:tag" content="Settings"><meta property="og:image" content="https://michalsn.dev/posts/building-a-production-ready-file-handler-for-codeigniter-4-settings/og.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://michalsn.dev/posts/building-a-production-ready-file-handler-for-codeigniter-4-settings/og.png"><meta name=twitter:title content="Building a Production-Ready File Handler for CodeIgniter 4 Settings"><meta name=twitter:description content="While CodeIgniter 4 Settings includes a database-backed handler, I wanted a file-based option that&rsquo;s lightweight, fast, and safe for production use. I&rsquo;ll walk through the challenges of handling concurrency, file locking, and caching, and explain the design choices behind the new FileHandler."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://michalsn.dev/posts/"},{"@type":"ListItem","position":2,"name":"Building a Production-Ready File Handler for CodeIgniter 4 Settings","item":"https://michalsn.dev/posts/building-a-production-ready-file-handler-for-codeigniter-4-settings/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Building a Production-Ready File Handler for CodeIgniter 4 Settings","name":"Building a Production-Ready File Handler for CodeIgniter 4 Settings","description":"While CodeIgniter 4 Settings includes a database-backed handler, I wanted a file-based option that\u0026rsquo;s lightweight, fast, and safe for production use. I\u0026rsquo;ll walk through the challenges of handling concurrency, file locking, and caching, and explain the design choices behind the new FileHandler.","keywords":["codeigniter4","settings"],"articleBody":"The CodeIgniter 4 Settings package provides a clean API for managing application configuration that changes at runtime. While it shipped with a DatabaseHandler for persistent storage, I wanted to offer an alternative: a file-based handler optimized for production use with proper concurrency handling.\nThis post dives into the technical challenges I encountered and the design decisions that shaped the implementation.\nWhy Build a FileHandler? The DatabaseHandler works great, but file-based storage offers distinct advantages:\nZero database dependency - Deploy without migrations or database setup Opcache acceleration - PHP files benefit from opcache, making reads essentially free after the first hit Simpler debugging - Open a file, see your settings. No SQL client needed. But building a file handler that’s actually production-ready? That’s where it gets interesting.\nChallenge #1: Race Conditions The core problem: multiple PHP processes writing to the same file simultaneously. Without proper handling, you get classic write conflicts:\nProcess A: Read file -\u003e Modify -\u003e Write back Process B: Read file -\u003e Modify -\u003e Write back Result: Process B's changes win, Process A's changes lost Initial Approach: One File for Everything My first instinct was simple: one file per context (production, testing, etc.), containing all classes:\nwritable/settings/ ├── general.php \u003c- ALL classes for null context └── production.php \u003c- ALL classes for production context Problem: Every write to any class in the same context would contend on the same file lock. With 10 config classes, you’d effectively serialize all writes, even for completely unrelated settings.\nThe Solution: One File Per Class+Context Instead, I isolated by class+context combination:\nwritable/settings/ ├── App_Config_Database.php \u003c- Database class, null context ├── App_Config_Email.php \u003c- Email class, null context └── 9eb667bc447b15815da4c9342efc4c3b/ \u003c- hash('xxh128', 'production') ├── App_Config_Database.php └── App_Config_Email.php Now writes to Database settings and Email settings are completely independent. Lock contention only happens when writing to the same class+context—exactly when coordination is actually needed.\nChallenge #2: The Merge Strategy Even with isolated files, I still have concurrent writes to the same class:\n// Process A $settings-\u003eset('Email.fromAddress', 'new@example.com'); // Process B (different PHP process, same moment) $settings-\u003eset('Email.fromName', 'New Name'); Each process has its own in-memory state (inheriting from ArrayHandler). Process A doesn’t know about fromName, Process B doesn’t know about fromAddress.\nNaive implementation:\nfunction persist() { $data = $this-\u003egetInMemoryData(); file_put_contents($file, serialize($data)); } Result: Whichever process writes last wins. The other process’s changes disappear.\nLock + Merge Pattern The solution requires re-reading after acquiring the lock. However, there’s a subtlety with deletions: array_merge() only adds or overwrites keys - it doesn’t remove them. When forget() removes a property from in-memory storage, that absence won’t propagate through the merge.\nThe solution tracks deletions explicitly:\nprivate array $deleted = []; public function set(string $class, string $property, $value = null, ?string $context = null) { $this-\u003ehydrate($class, $context); // Update in-memory storage first $this-\u003esetStored($class, $property, $value, $context); // Clear deletion tracking if this property was previously forgotten $key = $class . ($context === null ? '' : '::' . $context); unset($this-\u003edeleted[$key][$property]); // Persist to disk with file locking $this-\u003epersist($class, $context); } public function forget(string $class, string $property, ?string $context = null) { $this-\u003ehydrate($class, $context); // Delete from local storage $this-\u003eforgetStored($class, $property, $context); // Track this deletion for persist() $key = $class . ($context === null ? '' : '::' . $context); $this-\u003edeleted[$key][$property] = true; // Persist to disk with file locking $this-\u003epersist($class, $context); } private function persist(string $class, ?string $context): void { $filePath = $this-\u003egetFilePath($class, $context); // Open file and acquire exclusive lock (blocks other processes) $lockHandle = fopen($filePath, 'c+b'); flock($lockHandle, LOCK_EX); // Critical: clear stat cache BEFORE reading clearstatcache(true, $filePath); // Read current state (may have been modified since we started) $currentData = filesize($filePath) \u003e 0 ? include $filePath : []; // Merge current state with our changes $ourData = $this-\u003eextractDataForContext($class, $context); $mergedData = array_merge($currentData, $ourData); // Apply deletions (array_merge doesn't remove keys) $key = $class . ($context === null ? '' : '::' . $context); $toDelete = $this-\u003edeleted[$key] ?? []; foreach (array_keys($toDelete) as $property) { unset($mergedData[$property]); } // Write merged result file_put_contents($filePath, $this-\u003egeneratePhpFile($mergedData)); flock($lockHandle, LOCK_UN); fclose($lockHandle); } Now Process B’s write flow looks like:\nAcquire lock (waits for Process A to finish) Re-read file (sees Process A’s fromAddress change) Merge with own changes (fromName) Apply any tracked deletions Write the final result Both changes preserved, and deletions work correctly. The set() method clears deletion tracking to handle cases where a property is forgotten and then re-set.\nChallenge #3: The clearstatcache() Bug During testing, I hit a mysterious failure in in one of my tests:\n// Process A writes siteName $settings-\u003eset('Example.siteName', 'First'); // Simulate Process B manually modifying file (adds siteEmail) $data = include $filePath; $data['siteEmail'] = 'concurrent@example.com'; file_put_contents($filePath, ...); // Process A writes siteTitle $settings-\u003eset('Example.siteTitle', 'Second'); // Expected: All three properties // Actual: siteEmail missing! The debug output was confusing:\nBEFORE fopen: filesize = 250 bytes AFTER fopen: filesize = 0 bytes \u003c- Wait, what? The issue: PHP’s file stat cache. The fopen('c+b') mode creates the file if it doesn’t exist, returning filesize 0. PHP caches this stat. When I later modified the file externally, filesize() still returned the cached 0, so I skipped reading the file content.\nThe fix is subtle but critical:\nflock($lockHandle, LOCK_EX); clearstatcache(true, $filePath); // Clear cache after acquiring lock Without this, the merge logic silently uses stale size information and loses data.\nChallenge #4: Future-Proofing the Directory Structure Looking at DatabaseHandler, I noticed it can delete settings by class or context via SQL:\n-- Delete all settings for a class DELETE FROM settings WHERE class = 'App\\\\Config\\\\Email'; -- Delete all settings for a context DELETE FROM settings WHERE context = 'production'; I wanted the same capability eventually, but since DatabaseHandler doesn’t have an API for it yet, the trick is to design the file structure to allow it later.\nWhy Hash Context Directories? I initially considered plaintext directory names:\nwritable/settings/production/ But contexts can contain any characters (they’re just strings in DatabaseHandler). Filesystem special characters like /, :, \\ would break. I needed a safe, collision-free mapping.\nSolution: Hash context names using xxh128:\n$contextHash = hash('xxh128', $context); return $this-\u003epath . $contextHash . '/' . $className . '.php'; Now production becomes 9eb667bc447b15815da4c9342efc4c3b, and prod/weird:context becomes 1634c5d2a06947f80d1828f39a5fac50. All contexts are filesystem-safe, and I can reverse the mapping when needed.\nFuture API Possibilities This structure enables operations that are not implemented yet in the Settings package, but may be in the future:\n// Delete all settings for a class (future API) public function deleteClass(string $class): void { $className = str_replace('\\\\', '_', $class); unlink($this-\u003epath . $className . '.php'); // null context foreach (glob($this-\u003epath . '*/', GLOB_ONLYDIR) as $dir) { unlink($dir . $className . '.php'); // all contexts } } // Delete all settings for a context (future API) public function deleteContext(string $context): void { $contextHash = hash('xxh128', $context); $this-\u003edeleteDirectory($this-\u003epath . $contextHash . '/'); } The file structure makes these operations trivial to implement.\nPerformance Considerations Why GLOB_NOSORT? In my flush() implementation, I delete everything:\nforeach (glob($this-\u003epath . '*.php', GLOB_NOSORT) as $file) { unlink($file); } The GLOB_NOSORT flag skips the alphabetical sort. When you’re deleting everything anyway, why waste CPU cycles sorting? Small optimization, but these add up.\nWhy PHP Format Over JSON? I chose to store settings as PHP files, returning arrays:\n\u003c?php return [ 'fromAddress' =\u003e ['value' =\u003e 'admin@example.com', 'type' =\u003e 'string'], 'fromName' =\u003e ['value' =\u003e 'Administrator', 'type' =\u003e 'string'], ]; Why not JSON? Two reasons:\nOpcache - PHP’s opcache can cache compiled PHP files in memory. After the first read, subsequent include $file hits are essentially free. JSON files must be read and parsed every time.\nNative types - PHP’s var_export() preserves type information naturally. JSON requires explicit type preservation logic.\nThe tradeoff: PHP files are slightly less portable than JSON. For a CodeIgniter 4 package, that’s acceptable.\nLessons Learned 1. Concurrent programming is subtle\nThe clearstatcache() bug took real debugging to find. File operations that seem atomic often aren’t. Testing concurrent scenarios is essential.\n2. Optimize for the common case\nSeparate files per class means writes to different settings files happen in parallel - no blocking. Writes to the same class still block each other, but this only happens when absolutely necessary.\n3. Design for future extensibility\nThe hashed directory structure feels over-engineered for current needs. But it costs me nothing now and aligns with DatabaseHandler capabilities. Good architecture leaves doors open.\n","wordCount":"1375","inLanguage":"en","datePublished":"2025-10-29T19:33:19+02:00","dateModified":"2025-10-29T19:33:19+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://michalsn.dev/posts/building-a-production-ready-file-handler-for-codeigniter-4-settings/"},"publisher":{"@type":"Organization","name":"michalsn","logo":{"@type":"ImageObject","url":"https://michalsn.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://michalsn.dev/ accesskey=h title="michalsn (Alt + H)">michalsn</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://michalsn.dev/projects title=Projects><span>Projects</span></a></li><li><a href=https://michalsn.dev/archives title=Archive><span>Archive</span></a></li><li><a href=https://michalsn.dev/tags title=Tags><span>Tags</span></a></li><li><a href=https://michalsn.dev/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Building a Production-Ready File Handler for CodeIgniter 4 Settings</h1><div class=post-meta><span title='2025-10-29 19:33:19 +0200 +0200'>October 29, 2025</span>&nbsp;·&nbsp;7 min</div></header><div class=post-content><p>The <a href=https://github.com/codeigniter4/settings>CodeIgniter 4 Settings</a> package provides a clean API for managing application configuration that changes at runtime. While it shipped with a <code>DatabaseHandler</code> for persistent storage, I wanted to offer an alternative: a file-based handler optimized for production use with proper concurrency handling.</p><p>This post dives into the technical challenges I encountered and the design decisions that shaped the implementation.</p><h3 id=why-build-a-filehandler>Why Build a FileHandler?<a hidden class=anchor aria-hidden=true href=#why-build-a-filehandler>#</a></h3><p>The DatabaseHandler works great, but file-based storage offers distinct advantages:</p><ul><li><strong>Zero database dependency</strong> - Deploy without migrations or database setup</li><li><strong>Opcache acceleration</strong> - PHP files benefit from opcache, making reads essentially free after the first hit</li><li><strong>Simpler debugging</strong> - Open a file, see your settings. No SQL client needed.</li></ul><p>But building a file handler that&rsquo;s actually production-ready? That&rsquo;s where it gets interesting.</p><h3 id=challenge-1-race-conditions>Challenge #1: Race Conditions<a hidden class=anchor aria-hidden=true href=#challenge-1-race-conditions>#</a></h3><p>The core problem: multiple PHP processes writing to the same file simultaneously. Without proper handling, you get classic write conflicts:</p><pre tabindex=0><code>Process A: Read file -&gt; Modify -&gt; Write back
Process B: Read file -&gt; Modify -&gt; Write back
Result: Process B&#39;s changes win, Process A&#39;s changes lost
</code></pre><h4 id=initial-approach-one-file-for-everything>Initial Approach: One File for Everything<a hidden class=anchor aria-hidden=true href=#initial-approach-one-file-for-everything>#</a></h4><p>My first instinct was simple: one file per context (production, testing, etc.), containing all classes:</p><pre tabindex=0><code>writable/settings/
  ├── general.php      &lt;- ALL classes for null context
  └── production.php   &lt;- ALL classes for production context
</code></pre><p><strong>Problem:</strong> Every write to <em>any</em> class in the same context would contend on the same file lock. With 10 config classes, you&rsquo;d effectively serialize all writes, even for completely unrelated settings.</p><h4 id=the-solution-one-file-per-classcontext>The Solution: One File Per Class+Context<a hidden class=anchor aria-hidden=true href=#the-solution-one-file-per-classcontext>#</a></h4><p>Instead, I isolated by class+context combination:</p><pre tabindex=0><code>writable/settings/
  ├── App_Config_Database.php            &lt;- Database class, null context
  ├── App_Config_Email.php               &lt;- Email class, null context
  └── 9eb667bc447b15815da4c9342efc4c3b/  &lt;- hash(&#39;xxh128&#39;, &#39;production&#39;)
      ├── App_Config_Database.php
      └── App_Config_Email.php
</code></pre><p>Now writes to <code>Database</code> settings and <code>Email</code> settings are completely independent. Lock contention only happens when writing to the same class+context—exactly when coordination is actually needed.</p><h3 id=challenge-2-the-merge-strategy>Challenge #2: The Merge Strategy<a hidden class=anchor aria-hidden=true href=#challenge-2-the-merge-strategy>#</a></h3><p>Even with isolated files, I still have concurrent writes to the same class:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// Process A
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>$settings<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;Email.fromAddress&#39;</span>, <span style=color:#e6db74>&#39;new@example.com&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Process B (different PHP process, same moment)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>$settings<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;Email.fromName&#39;</span>, <span style=color:#e6db74>&#39;New Name&#39;</span>);
</span></span></code></pre></div><p>Each process has its own in-memory state (inheriting from <code>ArrayHandler</code>). Process A doesn&rsquo;t know about <code>fromName</code>, Process B doesn&rsquo;t know about <code>fromAddress</code>.</p><p>Naive implementation:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>persist</span>() {
</span></span><span style=display:flex><span>    $data <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getInMemoryData</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>file_put_contents</span>($file, <span style=color:#a6e22e>serialize</span>($data));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Result:</strong> Whichever process writes last wins. The other process&rsquo;s changes disappear.</p><h4 id=lock--merge-pattern>Lock + Merge Pattern<a hidden class=anchor aria-hidden=true href=#lock--merge-pattern>#</a></h4><p>The solution requires re-reading after acquiring the lock. However, there&rsquo;s a subtlety with deletions: <code>array_merge()</code> only adds or overwrites keys - it doesn&rsquo;t remove them. When <code>forget()</code> removes a property from in-memory storage, that absence won&rsquo;t propagate through the merge.</p><p>The solution tracks deletions explicitly:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>array</span> $deleted <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>set</span>(<span style=color:#a6e22e>string</span> $class, <span style=color:#a6e22e>string</span> $property, $value <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>, <span style=color:#f92672>?</span><span style=color:#a6e22e>string</span> $context <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>hydrate</span>($class, $context);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Update in-memory storage first
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setStored</span>($class, $property, $value, $context);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Clear deletion tracking if this property was previously forgotten
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $key <span style=color:#f92672>=</span> $class <span style=color:#f92672>.</span> ($context <span style=color:#f92672>===</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;::&#39;</span> <span style=color:#f92672>.</span> $context);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>unset</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>deleted</span>[$key][$property]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Persist to disk with file locking
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>persist</span>($class, $context);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>forget</span>(<span style=color:#a6e22e>string</span> $class, <span style=color:#a6e22e>string</span> $property, <span style=color:#f92672>?</span><span style=color:#a6e22e>string</span> $context <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>hydrate</span>($class, $context);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Delete from local storage
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>forgetStored</span>($class, $property, $context);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Track this deletion for persist()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $key <span style=color:#f92672>=</span> $class <span style=color:#f92672>.</span> ($context <span style=color:#f92672>===</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;::&#39;</span> <span style=color:#f92672>.</span> $context);
</span></span><span style=display:flex><span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>deleted</span>[$key][$property] <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Persist to disk with file locking
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>persist</span>($class, $context);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>persist</span>(<span style=color:#a6e22e>string</span> $class, <span style=color:#f92672>?</span><span style=color:#a6e22e>string</span> $context)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    $filePath <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getFilePath</span>($class, $context);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Open file and acquire exclusive lock (blocks other processes)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $lockHandle <span style=color:#f92672>=</span> <span style=color:#a6e22e>fopen</span>($filePath, <span style=color:#e6db74>&#39;c+b&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>flock</span>($lockHandle, <span style=color:#a6e22e>LOCK_EX</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Critical: clear stat cache BEFORE reading
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>clearstatcache</span>(<span style=color:#66d9ef>true</span>, $filePath);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Read current state (may have been modified since we started)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $currentData <span style=color:#f92672>=</span> <span style=color:#a6e22e>filesize</span>($filePath) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>include</span> $filePath <span style=color:#f92672>:</span> [];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Merge current state with our changes
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $ourData <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>extractDataForContext</span>($class, $context);
</span></span><span style=display:flex><span>    $mergedData <span style=color:#f92672>=</span> <span style=color:#a6e22e>array_merge</span>($currentData, $ourData);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Apply deletions (array_merge doesn&#39;t remove keys)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $key <span style=color:#f92672>=</span> $class <span style=color:#f92672>.</span> ($context <span style=color:#f92672>===</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;::&#39;</span> <span style=color:#f92672>.</span> $context);
</span></span><span style=display:flex><span>    $toDelete <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>deleted</span>[$key] <span style=color:#f92672>??</span> [];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>foreach</span> (<span style=color:#a6e22e>array_keys</span>($toDelete) <span style=color:#66d9ef>as</span> $property) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>unset</span>($mergedData[$property]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Write merged result
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>file_put_contents</span>($filePath, $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>generatePhpFile</span>($mergedData));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>flock</span>($lockHandle, <span style=color:#a6e22e>LOCK_UN</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fclose</span>($lockHandle);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Now Process B&rsquo;s write flow looks like:</p><ol><li>Acquire lock (waits for Process A to finish)</li><li>Re-read file (sees Process A&rsquo;s <code>fromAddress</code> change)</li><li>Merge with own changes (<code>fromName</code>)</li><li>Apply any tracked deletions</li><li>Write the final result</li></ol><p>Both changes preserved, and deletions work correctly. The <code>set()</code> method clears deletion tracking to handle cases where a property is forgotten and then re-set.</p><h3 id=challenge-3-the-clearstatcache-bug>Challenge #3: The <code>clearstatcache()</code> Bug<a hidden class=anchor aria-hidden=true href=#challenge-3-the-clearstatcache-bug>#</a></h3><p>During testing, I hit a mysterious failure in in one of my tests:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// Process A writes siteName
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>$settings<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;Example.siteName&#39;</span>, <span style=color:#e6db74>&#39;First&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Simulate Process B manually modifying file (adds siteEmail)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>$data <span style=color:#f92672>=</span> <span style=color:#66d9ef>include</span> $filePath;
</span></span><span style=display:flex><span>$data[<span style=color:#e6db74>&#39;siteEmail&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;concurrent@example.com&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>file_put_contents</span>($filePath, <span style=color:#f92672>...</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Process A writes siteTitle
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>$settings<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;Example.siteTitle&#39;</span>, <span style=color:#e6db74>&#39;Second&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Expected: All three properties
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Actual: siteEmail missing!
</span></span></span></code></pre></div><p>The debug output was confusing:</p><pre tabindex=0><code>BEFORE fopen: filesize = 250 bytes
AFTER fopen: filesize = 0 bytes  &lt;- Wait, what?
</code></pre><p><strong>The issue:</strong> PHP&rsquo;s file stat cache. The <code>fopen('c+b')</code> mode creates the file if it doesn&rsquo;t exist, returning filesize 0. PHP caches this stat. When I later modified the file externally, <code>filesize()</code> still returned the cached 0, so I skipped reading the file content.</p><p>The fix is subtle but critical:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>flock</span>($lockHandle, <span style=color:#a6e22e>LOCK_EX</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>clearstatcache</span>(<span style=color:#66d9ef>true</span>, $filePath);  <span style=color:#75715e>// Clear cache after acquiring lock
</span></span></span></code></pre></div><p>Without this, the merge logic silently uses stale size information and loses data.</p><h3 id=challenge-4-future-proofing-the-directory-structure>Challenge #4: Future-Proofing the Directory Structure<a hidden class=anchor aria-hidden=true href=#challenge-4-future-proofing-the-directory-structure>#</a></h3><p>Looking at <code>DatabaseHandler</code>, I noticed it can delete settings by class or context via SQL:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- Delete all settings for a class
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>FROM</span> settings <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>class</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;App\\Config\\Email&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Delete all settings for a context
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>FROM</span> settings <span style=color:#66d9ef>WHERE</span> context <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;production&#39;</span>;
</span></span></code></pre></div><p>I wanted the same capability eventually, but since <code>DatabaseHandler</code> doesn&rsquo;t have an API for it yet, the trick is to design the file structure to allow it later.</p><h4 id=why-hash-context-directories>Why Hash Context Directories?<a hidden class=anchor aria-hidden=true href=#why-hash-context-directories>#</a></h4><p>I initially considered plaintext directory names:</p><pre tabindex=0><code>writable/settings/production/
</code></pre><p>But contexts can contain <em>any</em> characters (they&rsquo;re just strings in <code>DatabaseHandler</code>). Filesystem special characters like <code>/</code>, <code>:</code>, <code>\</code> would break. I needed a safe, collision-free mapping.</p><p><strong>Solution:</strong> Hash context names using <code>xxh128</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$contextHash <span style=color:#f92672>=</span> <span style=color:#a6e22e>hash</span>(<span style=color:#e6db74>&#39;xxh128&#39;</span>, $context);
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>path</span> <span style=color:#f92672>.</span> $contextHash <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;/&#39;</span> <span style=color:#f92672>.</span> $className <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;.php&#39;</span>;
</span></span></code></pre></div><p>Now <code>production</code> becomes <code>9eb667bc447b15815da4c9342efc4c3b</code>, and <code>prod/weird:context</code> becomes <code>1634c5d2a06947f80d1828f39a5fac50</code>. All contexts are filesystem-safe, and I can reverse the mapping when needed.</p><h4 id=future-api-possibilities>Future API Possibilities<a hidden class=anchor aria-hidden=true href=#future-api-possibilities>#</a></h4><p>This structure enables operations that are not implemented yet in the Settings package, but may be in the future:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// Delete all settings for a class (future API)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>deleteClass</span>(<span style=color:#a6e22e>string</span> $class)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    $className <span style=color:#f92672>=</span> <span style=color:#a6e22e>str_replace</span>(<span style=color:#e6db74>&#39;\\&#39;</span>, <span style=color:#e6db74>&#39;_&#39;</span>, $class);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>unlink</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>path</span> <span style=color:#f92672>.</span> $className <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;.php&#39;</span>);  <span style=color:#75715e>// null context
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>foreach</span> (<span style=color:#a6e22e>glob</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>path</span> <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;*/&#39;</span>, <span style=color:#a6e22e>GLOB_ONLYDIR</span>) <span style=color:#66d9ef>as</span> $dir) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>unlink</span>($dir <span style=color:#f92672>.</span> $className <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;.php&#39;</span>);  <span style=color:#75715e>// all contexts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Delete all settings for a context (future API)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>deleteContext</span>(<span style=color:#a6e22e>string</span> $context)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    $contextHash <span style=color:#f92672>=</span> <span style=color:#a6e22e>hash</span>(<span style=color:#e6db74>&#39;xxh128&#39;</span>, $context);
</span></span><span style=display:flex><span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>deleteDirectory</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>path</span> <span style=color:#f92672>.</span> $contextHash <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;/&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The file structure makes these operations trivial to implement.</p><h3 id=performance-considerations>Performance Considerations<a hidden class=anchor aria-hidden=true href=#performance-considerations>#</a></h3><h4 id=why-glob_nosort>Why <code>GLOB_NOSORT</code>?<a hidden class=anchor aria-hidden=true href=#why-glob_nosort>#</a></h4><p>In my <code>flush()</code> implementation, I delete everything:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>foreach</span> (<span style=color:#a6e22e>glob</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>path</span> <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;*.php&#39;</span>, <span style=color:#a6e22e>GLOB_NOSORT</span>) <span style=color:#66d9ef>as</span> $file) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>unlink</span>($file);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The <code>GLOB_NOSORT</code> flag skips the alphabetical sort. When you&rsquo;re deleting everything anyway, why waste CPU cycles sorting? Small optimization, but these add up.</p><h4 id=why-php-format-over-json>Why PHP Format Over JSON?<a hidden class=anchor aria-hidden=true href=#why-php-format-over-json>#</a></h4><p>I chose to store settings as PHP files, returning arrays:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;fromAddress&#39;</span> <span style=color:#f92672>=&gt;</span> [<span style=color:#e6db74>&#39;value&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;admin@example.com&#39;</span>, <span style=color:#e6db74>&#39;type&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;string&#39;</span>],
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;fromName&#39;</span> <span style=color:#f92672>=&gt;</span> [<span style=color:#e6db74>&#39;value&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;Administrator&#39;</span>, <span style=color:#e6db74>&#39;type&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;string&#39;</span>],
</span></span><span style=display:flex><span>];
</span></span></code></pre></div><p>Why not JSON? Two reasons:</p><ol><li><p><strong>Opcache</strong> - PHP&rsquo;s opcache can cache compiled PHP files in memory. After the first read, subsequent <code>include $file</code> hits are essentially free. JSON files must be read and parsed every time.</p></li><li><p><strong>Native types</strong> - PHP&rsquo;s <code>var_export()</code> preserves type information naturally. JSON requires explicit type preservation logic.</p></li></ol><p>The tradeoff: PHP files are slightly less portable than JSON. For a CodeIgniter 4 package, that&rsquo;s acceptable.</p><h3 id=lessons-learned>Lessons Learned<a hidden class=anchor aria-hidden=true href=#lessons-learned>#</a></h3><p><strong>1. Concurrent programming is subtle</strong></p><p>The <code>clearstatcache()</code> bug took real debugging to find. File operations that seem atomic often aren&rsquo;t. Testing concurrent scenarios is essential.</p><p><strong>2. Optimize for the common case</strong></p><p>Separate files per class means writes to different settings files happen in parallel - no blocking. Writes to the same class still block each other, but this only happens when absolutely necessary.</p><p><strong>3. Design for future extensibility</strong></p><p>The hashed directory structure feels over-engineered for current needs. But it costs me nothing now and aligns with <code>DatabaseHandler</code> capabilities. Good architecture leaves doors open.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://michalsn.dev/tags/codeigniter4/>Codeigniter4</a></li><li><a href=https://michalsn.dev/tags/settings/>Settings</a></li></ul><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Building a Production-Ready File Handler for CodeIgniter 4 Settings on x" href="https://x.com/intent/tweet/?text=Building%20a%20Production-Ready%20File%20Handler%20for%20CodeIgniter%204%20Settings&amp;url=https%3a%2f%2fmichalsn.dev%2fposts%2fbuilding-a-production-ready-file-handler-for-codeigniter-4-settings%2f&amp;hashtags=codeigniter4%2csettings"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Building a Production-Ready File Handler for CodeIgniter 4 Settings on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fmichalsn.dev%2fposts%2fbuilding-a-production-ready-file-handler-for-codeigniter-4-settings%2f&amp;title=Building%20a%20Production-Ready%20File%20Handler%20for%20CodeIgniter%204%20Settings&amp;summary=Building%20a%20Production-Ready%20File%20Handler%20for%20CodeIgniter%204%20Settings&amp;source=https%3a%2f%2fmichalsn.dev%2fposts%2fbuilding-a-production-ready-file-handler-for-codeigniter-4-settings%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Building a Production-Ready File Handler for CodeIgniter 4 Settings on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fmichalsn.dev%2fposts%2fbuilding-a-production-ready-file-handler-for-codeigniter-4-settings%2f&title=Building%20a%20Production-Ready%20File%20Handler%20for%20CodeIgniter%204%20Settings"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Building a Production-Ready File Handler for CodeIgniter 4 Settings on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmichalsn.dev%2fposts%2fbuilding-a-production-ready-file-handler-for-codeigniter-4-settings%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Building a Production-Ready File Handler for CodeIgniter 4 Settings on whatsapp" href="https://api.whatsapp.com/send?text=Building%20a%20Production-Ready%20File%20Handler%20for%20CodeIgniter%204%20Settings%20-%20https%3a%2f%2fmichalsn.dev%2fposts%2fbuilding-a-production-ready-file-handler-for-codeigniter-4-settings%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Building a Production-Ready File Handler for CodeIgniter 4 Settings on telegram" href="https://telegram.me/share/url?text=Building%20a%20Production-Ready%20File%20Handler%20for%20CodeIgniter%204%20Settings&amp;url=https%3a%2f%2fmichalsn.dev%2fposts%2fbuilding-a-production-ready-file-handler-for-codeigniter-4-settings%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Building a Production-Ready File Handler for CodeIgniter 4 Settings on ycombinator" href="https://news.ycombinator.com/submitlink?t=Building%20a%20Production-Ready%20File%20Handler%20for%20CodeIgniter%204%20Settings&u=https%3a%2f%2fmichalsn.dev%2fposts%2fbuilding-a-production-ready-file-handler-for-codeigniter-4-settings%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><script src=https://utteranc.es/client.js repo=michalsn/michalsn.dev issue-term=pathname label=comments theme=preferred-color-scheme crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2025 <a href=https://michalsn.dev/>michalsn</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg></a><div id=cookie-notice role=dialog aria-live=polite aria-label="Cookie notice"><div class=inner><span>This website uses third-party cookies and scripts to improve its functionality.</span>
<a id=cookie-notice-accept class="btn btn-primary btn-sm">Approve</a>
<a id=cookie-notice-deny class="btn btn-primary btn-sm">Deny</a>
<a id=cookie-notice-info href=/privacy class="btn btn-primary btn-sm">More info</a></div></div><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>