<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>CodeIgniter Queue | michalsn</title><meta name=keywords content="queue,database,codeigniter4"><meta name=description content="While CodeIgniter 4 itself doesn&rsquo;t have a built-in queue system, I have built one which rely on the database handler.
But what is a queue? It&rsquo;s a system that allows you to schedule and manage background tasks or jobs to be executed in the given order. These jobs can include sending emails, processing data, generating reports, and more. Using a queue system helps offload time-consuming or resource-intensive tasks from the main application, ensuring that the application remains responsive."><meta name=author content><link rel=canonical href=https://michalsn.dev/posts/codeigniter-queue/><link crossorigin=anonymous href=/assets/css/stylesheet.min.b9ff4cc257e914dab489bd18086151800e18f91456a5174bf28489210227a659.css integrity="sha256-uf9MwlfpFNq0ib0YCGFRgA4Y+RRWpRdL8oSJIQInplk=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://michalsn.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://michalsn.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://michalsn.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://michalsn.dev/apple-touch-icon.png><link rel=mask-icon href=https://michalsn.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.110.0"><script async src="https://www.googletagmanager.com/gtag/js?id=G-74HSH0WCPE"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-74HSH0WCPE",{anonymize_ip:!1})}</script><meta property="og:title" content="CodeIgniter Queue"><meta property="og:description" content="While CodeIgniter 4 itself doesn&rsquo;t have a built-in queue system, I have built one which rely on the database handler.
But what is a queue? It&rsquo;s a system that allows you to schedule and manage background tasks or jobs to be executed in the given order. These jobs can include sending emails, processing data, generating reports, and more. Using a queue system helps offload time-consuming or resource-intensive tasks from the main application, ensuring that the application remains responsive."><meta property="og:type" content="article"><meta property="og:url" content="https://michalsn.dev/posts/codeigniter-queue/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-10-14T15:36:19+01:00"><meta property="article:modified_time" content="2023-10-14T15:36:19+01:00"><meta property="og:site_name" content="michalsn"><meta name=twitter:card content="summary"><meta name=twitter:title content="CodeIgniter Queue"><meta name=twitter:description content="While CodeIgniter 4 itself doesn&rsquo;t have a built-in queue system, I have built one which rely on the database handler.
But what is a queue? It&rsquo;s a system that allows you to schedule and manage background tasks or jobs to be executed in the given order. These jobs can include sending emails, processing data, generating reports, and more. Using a queue system helps offload time-consuming or resource-intensive tasks from the main application, ensuring that the application remains responsive."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://michalsn.dev/posts/"},{"@type":"ListItem","position":2,"name":"CodeIgniter Queue","item":"https://michalsn.dev/posts/codeigniter-queue/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"CodeIgniter Queue","name":"CodeIgniter Queue","description":"While CodeIgniter 4 itself doesn\u0026rsquo;t have a built-in queue system, I have built one which rely on the database handler.\nBut what is a queue? It\u0026rsquo;s a system that allows you to schedule and manage background tasks or jobs to be executed in the given order. These jobs can include sending emails, processing data, generating reports, and more. Using a queue system helps offload time-consuming or resource-intensive tasks from the main application, ensuring that the application remains responsive.","keywords":["queue","database","codeigniter4"],"articleBody":"While CodeIgniter 4 itself doesn’t have a built-in queue system, I have built one which rely on the database handler.\nBut what is a queue? It’s a system that allows you to schedule and manage background tasks or jobs to be executed in the given order. These jobs can include sending emails, processing data, generating reports, and more. Using a queue system helps offload time-consuming or resource-intensive tasks from the main application, ensuring that the application remains responsive.\nHere is the project repo.\nUpdate 15/12/2023: This project has become the official CodeIgniter Queue project. The repository has been moved to the CodeIgniter4 organization.\nFirst things first. Let’s install the package:\ncomposer require michalsn/codeigniter-queue And migrate our database:\nphp spark migrate --all Last thing, during installation is to publish our config file:\nphp spark queue:publish Now, we can create our first Job:\nphp spark queue:job Example And implement our example job in the process method:\n// ... class Example extends BaseJob implements JobInterface { public function process() { $email = service('email', null, false); $result = $email -\u003esetTo('sample@email.com') -\u003esetSubject('Sample subject') -\u003esetMessage($this-\u003edata['message']) -\u003esend(false); if (! $result) { throw new Exception($email-\u003eprintDebugger('headers')); } return $result; } } This job will just send an email. The only variable is a message, which is available via the $this-\u003edata class variable. If sending an email will not be successful, the exception will be thrown. This will indicate that the job failed.\nTo make this job available, we have to add it to the $jobHandlers array in the app\\Config\\Queue.php file.\n// ... use App\\Jobs\\Example; // ... public array $jobHandlers = [ 'my-example' =\u003e Example::class ]; // ... This is how we will add our job to the queue:\nservice('queue')-\u003epush('queueName', 'my-example', ['message' =\u003e 'Hello there']); To start executing the jobs, we have to start the worker:\nphp spark queue:work queueName That’s pretty much it. There are many additional option and ways to run a queue worker, though.\nTo learn more you can check the docs.\n","wordCount":"325","inLanguage":"en","datePublished":"2023-10-14T15:36:19+01:00","dateModified":"2023-10-14T15:36:19+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://michalsn.dev/posts/codeigniter-queue/"},"publisher":{"@type":"Organization","name":"michalsn","logo":{"@type":"ImageObject","url":"https://michalsn.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://michalsn.dev/ accesskey=h title="michalsn (Alt + H)">michalsn</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://michalsn.dev/archives title=Archive><span>Archive</span></a></li><li><a href=https://michalsn.dev/tags title=Tags><span>Tags</span></a></li><li><a href=https://michalsn.dev/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>CodeIgniter Queue</h1><div class=post-meta>October 14, 2023&nbsp;·&nbsp;2 min</div></header><div class=post-content><p>While CodeIgniter 4 itself doesn&rsquo;t have a built-in queue system, I have built one which rely on the database handler.</p><p>But what is a queue? It&rsquo;s a system that allows you to schedule and manage background tasks or jobs to be executed in the given order. These jobs can include sending emails, processing data, generating reports, and more. Using a queue system helps offload time-consuming or resource-intensive tasks from the main application, ensuring that the application remains responsive.</p><p>Here is the project <a href=https://github.com/michalsn/codeigniter-queue>repo</a>.</p><p><strong>Update 15/12/2023</strong>: This project has become the <a href=https://github.com/codeigniter4/queue>official CodeIgniter Queue</a> project. The repository has been moved to the CodeIgniter4 organization.</p><p>First things first. Let&rsquo;s install the package:</p><pre><code>composer require michalsn/codeigniter-queue
</code></pre><p>And migrate our database:</p><pre><code>php spark migrate --all
</code></pre><p>Last thing, during installation is to publish our config file:</p><pre><code>php spark queue:publish
</code></pre><p>Now, we can create our first Job:</p><pre><code>php spark queue:job Example
</code></pre><p>And implement our example job in the <code>process</code> method:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Example</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>BaseJob</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>JobInterface</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>process</span>()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $email  <span style=color:#f92672>=</span> <span style=color:#a6e22e>service</span>(<span style=color:#e6db74>&#39;email&#39;</span>, <span style=color:#66d9ef>null</span>, <span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>        $result <span style=color:#f92672>=</span> $email
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setTo</span>(<span style=color:#e6db74>&#39;sample@email.com&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setSubject</span>(<span style=color:#e6db74>&#39;Sample subject&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setMessage</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>data</span>[<span style=color:#e6db74>&#39;message&#39;</span>])
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>send</span>(<span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span> $result) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Exception</span>($email<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>printDebugger</span>(<span style=color:#e6db74>&#39;headers&#39;</span>));
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $result;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This job will just send an email. The only variable is a <code>message</code>, which is available via the <code>$this->data</code> class variable.
If sending an email will not be successful, the exception will be thrown. This will indicate that the job failed.</p><p>To make this job available, we have to add it to the <code>$jobHandlers</code> array in the <code>app\Config\Queue.php</code> file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Jobs\Example</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>array</span> $jobHandlers <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;my-example&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Example</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>
</span></span><span style=display:flex><span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ...
</span></span></span></code></pre></div><p>This is how we will add our job to the queue:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>service</span>(<span style=color:#e6db74>&#39;queue&#39;</span>)<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>push</span>(<span style=color:#e6db74>&#39;queueName&#39;</span>, <span style=color:#e6db74>&#39;my-example&#39;</span>, [<span style=color:#e6db74>&#39;message&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;Hello there&#39;</span>]);
</span></span></code></pre></div><p>To start executing the jobs, we have to start the worker:</p><pre><code>php spark queue:work queueName
</code></pre><p>That&rsquo;s pretty much it. There are many additional option and ways to run a queue worker, though.</p><p>To learn more you can check the <a href=https://michalsn.github.io/codeigniter-queue/>docs</a>.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://michalsn.dev/tags/queue/>queue</a></li><li><a href=https://michalsn.dev/tags/database/>database</a></li><li><a href=https://michalsn.dev/tags/codeigniter4/>codeigniter4</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://michalsn.dev/>michalsn</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>