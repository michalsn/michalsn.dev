<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>CodeIgniter 4 + Mix with versioning | michalsn</title>
<meta name=keywords content="mix,codeigniter4">
<meta name=description content="Last time I showed you how to easily integrate Mix with CodeIgniter 4. This time we&rsquo;ll complete the integration process by implementing a helper which will make using versioned assets very convenient and easy.">
<meta name=author content>
<link rel=canonical href=https://michalsn.dev/posts/codeigniter-4-mix-versioning/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.b9ff4cc257e914dab489bd18086151800e18f91456a5174bf28489210227a659.css integrity="sha256-uf9MwlfpFNq0ib0YCGFRgA4Y+RRWpRdL8oSJIQInplk=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://michalsn.dev/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://michalsn.dev/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://michalsn.dev/favicon-32x32.png>
<link rel=apple-touch-icon href=https://michalsn.dev/apple-touch-icon.png>
<link rel=mask-icon href=https://michalsn.dev/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.89.4">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-74HSH0WCPE"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-74HSH0WCPE',{anonymize_ip:!1})}</script>
<meta property="og:title" content="CodeIgniter 4 + Mix with versioning">
<meta property="og:description" content="Last time I showed you how to easily integrate Mix with CodeIgniter 4. This time we&rsquo;ll complete the integration process by implementing a helper which will make using versioned assets very convenient and easy.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://michalsn.dev/posts/codeigniter-4-mix-versioning/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-08-25T21:05:40+02:00">
<meta property="article:modified_time" content="2021-08-25T21:05:40+02:00"><meta property="og:site_name" content="michalsn">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="CodeIgniter 4 + Mix with versioning">
<meta name=twitter:description content="Last time I showed you how to easily integrate Mix with CodeIgniter 4. This time we&rsquo;ll complete the integration process by implementing a helper which will make using versioned assets very convenient and easy.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://michalsn.dev/posts/"},{"@type":"ListItem","position":2,"name":"CodeIgniter 4 + Mix with versioning","item":"https://michalsn.dev/posts/codeigniter-4-mix-versioning/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"CodeIgniter 4 + Mix with versioning","name":"CodeIgniter 4 \u002b Mix with versioning","description":"Last time I showed you how to easily integrate Mix with CodeIgniter 4. This time we\u0026rsquo;ll complete the integration process by implementing a helper which will make using versioned assets very convenient and easy.\n","keywords":["mix","codeigniter4"],"articleBody":"Last time I showed you how to easily integrate Mix with CodeIgniter 4. This time we’ll complete the integration process by implementing a helper which will make using versioned assets very convenient and easy.\nWhy do we even need this helper? Mix can generate versioned versions of files. In short, it does this by adding a special string to the file name, as a query string. This string is the checksum for the file. If it changes, it tells the browser that it needs to download the resource again, not use the cache.\nWe need to create a file mix_helper.php in app/helpers/ directory:\nif (! function_exists('mix')) { /** * Get the path to a versioned Mix file. * * @param string $path * @param string $manifestDirectory * * @return string * * @throws Exception */ function mix(string $path, string $manifestDirectory = ''): string { static $manifests = []; $publicPath = ROOTPATH . 'public'; if ($path[0] !== '/') { $path = \"/{$path}\"; } if ($manifestDirectory \u0026\u0026 $manifestDirectory[0] !== '/') { $manifestDirectory = \"/{$manifestDirectory}\"; } if (is_file($publicPath . $manifestDirectory . '/hot')) { $url = rtrim(file_get_contents($publicPath . $manifestDirectory . '/hot')); $customUrl = config('Mix')-hotProxyUrl; if (! empty($customUrl)) { return $customUrl . $path; } if (strpos($url , 'http://') === 0 || strpos($url , 'https://') === 0) { return explode(':', $url, 2)[1] . $path; } return \"//localhost:8080{$path}\"; } $manifestPath = $publicPath . $manifestDirectory . '/mix-manifest.json'; if (! isset($manifests[$manifestPath])) { if (! is_file($manifestPath)) { throw new Exception('The Mix manifest does not exist.'); } $manifests[$manifestPath] = json_decode(file_get_contents($manifestPath), true); } $manifest = $manifests[$manifestPath]; if (! isset($manifest[$path])) { $exception = new Exception(\"Unable to locate Mix file: {$path}.\"); if (! CI_DEBUG) { return $path; } else { throw $exception; } } return config('Mix')-url . $manifestDirectory . $manifest[$path]; } } Next, we create the Mix.php configuration file in the app/config/ directory:\nThere is a good chance that you won’t need to change anything in the configuration file, because you will only be using local resources, but you can change a few settings if you need to.\nHow to use this helper? It’s very simple - just enter an ordinary file name and helper will add appropriate query string, based on mix-manifest.json file generated during asset compilation.\nThis is what our asset configuration file will look like (webpack.mix.js):\nlet mix = require('laravel-mix'); mix.js('resources/js/app.js', 'js') .postCss('resources/css/app.css', 'css') .version() .setPublicPath('public'); And in our view we will apply a helper:\n\" rel=\"stylesheet\" This will get a link similar to this one:\nThe same for JS files. Without the helper we would have to manually rename the versioned files every time.\n","wordCount":"482","inLanguage":"en","datePublished":"2021-08-25T21:05:40+02:00","dateModified":"2021-08-25T21:05:40+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://michalsn.dev/posts/codeigniter-4-mix-versioning/"},"publisher":{"@type":"Organization","name":"michalsn","logo":{"@type":"ImageObject","url":"https://michalsn.dev/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<noscript>
<style type=text/css>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://michalsn.dev/ accesskey=h title="michalsn (Alt + H)">michalsn</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://michalsn.dev/archives title=Archive>
<span>Archive</span>
</a>
</li>
<li>
<a href=https://michalsn.dev/tags title=Tags>
<span>Tags</span>
</a>
</li>
<li>
<a href=https://michalsn.dev/search title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
CodeIgniter 4 + Mix with versioning
</h1>
<div class=post-meta>August 25, 2021&nbsp;·&nbsp;3 min
</div>
</header>
<div class=post-content><p>Last time I showed you how to easily integrate Mix with CodeIgniter 4. This time we&rsquo;ll complete the integration process by implementing a helper which will make using versioned assets very convenient and easy.</p>
<p>Why do we even need this helper? Mix can generate versioned versions of files. In short, it does this by adding a special string to the file name, as a query string. This string is the checksum for the file. If it changes, it tells the browser that it needs to download the resource again, not use the cache.</p>
<p>We need to create a file <strong>mix_helper.php</strong> in <strong>app/helpers/</strong> directory:</p>
<pre tabindex=0><code>if (! function_exists('mix')) {
    /**
     * Get the path to a versioned Mix file.
     *
     * @param string $path
     * @param string $manifestDirectory
     *
     * @return string
     *
     * @throws Exception
     */
    function mix(string $path, string $manifestDirectory = ''): string
    {
        static $manifests = [];

        $publicPath = ROOTPATH . 'public';

        if ($path[0] !== '/') {
            $path = &quot;/{$path}&quot;;
        }

        if ($manifestDirectory &amp;&amp; $manifestDirectory[0] !== '/') {
            $manifestDirectory = &quot;/{$manifestDirectory}&quot;;
        }

        if (is_file($publicPath . $manifestDirectory . '/hot')) {
            $url = rtrim(file_get_contents($publicPath . $manifestDirectory . '/hot'));

            $customUrl = config('Mix')-&gt;hotProxyUrl;

            if (! empty($customUrl)) {
                return $customUrl . $path;
            }

            if (strpos($url , 'http://') === 0 || strpos($url , 'https://') === 0) {
                return explode(':', $url, 2)[1] . $path;
            }

            return &quot;//localhost:8080{$path}&quot;;
        }

        $manifestPath = $publicPath . $manifestDirectory . '/mix-manifest.json';

        if (! isset($manifests[$manifestPath])) {
            if (! is_file($manifestPath)) {
                throw new Exception('The Mix manifest does not exist.');
            }

            $manifests[$manifestPath] = json_decode(file_get_contents($manifestPath), true);
        }

        $manifest = $manifests[$manifestPath];

        if (! isset($manifest[$path])) {
            $exception = new Exception(&quot;Unable to locate Mix file: {$path}.&quot;);

            if (! CI_DEBUG) {
                return $path;
            } else {
                throw $exception;
            }
        }

        return config('Mix')-&gt;url . $manifestDirectory . $manifest[$path];
    }
}
</code></pre><p>Next, we create the <strong>Mix.php</strong> configuration file in the <strong>app/config/</strong> directory:</p>
<pre tabindex=0><code>&lt;?php
namespace Config;

use CodeIgniter\Config\BaseConfig;

class Mix extends BaseConfig
{
    /**
     * Url for CDN.
     * Leave empty if using local files.
     *
     * @var string
     */
    public $url = '';

    /**
     * Hot reload Url.
     * Leave empty for default localhost:8080.
     *
     * @var string
     */
    public $hotProxyUrl = '';
}
</code></pre><p>There is a good chance that you won&rsquo;t need to change anything in the configuration file, because you will only be using local resources, but you can change a few settings if you need to.</p>
<p>How to use this helper? It&rsquo;s very simple - just enter an <em>ordinary</em> file name and helper will add appropriate query string, based on <strong>mix-manifest.json</strong> file generated during asset compilation.</p>
<p>This is what our asset configuration file will look like (<strong>webpack.mix.js</strong>):</p>
<pre tabindex=0><code>let mix = require('laravel-mix');

mix.js('resources/js/app.js', 'js')
    .postCss('resources/css/app.css', 'css')
    .version()
    .setPublicPath('public');
</code></pre><p>And in our view we will apply a helper:</p>
<pre tabindex=0><code>&lt;link href=&quot;&lt;?= mix('/css/app.css'); ?&gt;&quot; rel=&quot;stylesheet&quot;&gt;
</code></pre><p>This will get a link similar to this one:</p>
<pre tabindex=0><code>&lt;link href=&quot;/css/app.css?id=a8b3deb4b7d26dcf51d2&quot; rel=&quot;stylesheet&quot;&gt;
</code></pre><p>The same for JS files. Without the helper we would have to manually rename the versioned files every time.</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://michalsn.dev/tags/mix/>mix</a></li>
<li><a href=https://michalsn.dev/tags/codeigniter4/>codeigniter4</a></li>
</ul>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://michalsn.dev/>michalsn</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)">
<button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</button>
</a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>