<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Serverless Codeigniter 4 | michalsn</title><meta name=keywords content="serverless,bref,aws,codeigniter4"><meta name=description content="Serverless has been very popular for several years now. When we need very high performance it can be a very good alternative to traditional server solutions. Therefore, this time we will try to run CodeIgniter 4 in a serverless environment."><meta name=author content><link rel=canonical href=https://michalsn.dev/posts/serverless-codeigniter-4/><link crossorigin=anonymous href=/assets/css/stylesheet.min.b9ff4cc257e914dab489bd18086151800e18f91456a5174bf28489210227a659.css integrity="sha256-uf9MwlfpFNq0ib0YCGFRgA4Y+RRWpRdL8oSJIQInplk=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://michalsn.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://michalsn.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://michalsn.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://michalsn.dev/apple-touch-icon.png><link rel=mask-icon href=https://michalsn.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.109.0"><script async src="https://www.googletagmanager.com/gtag/js?id=G-74HSH0WCPE"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-74HSH0WCPE",{anonymize_ip:!1})}</script><meta property="og:title" content="Serverless Codeigniter 4"><meta property="og:description" content="Serverless has been very popular for several years now. When we need very high performance it can be a very good alternative to traditional server solutions. Therefore, this time we will try to run CodeIgniter 4 in a serverless environment."><meta property="og:type" content="article"><meta property="og:url" content="https://michalsn.dev/posts/serverless-codeigniter-4/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-07T18:24:14+02:00"><meta property="article:modified_time" content="2022-07-07T18:24:14+02:00"><meta property="og:site_name" content="michalsn"><meta name=twitter:card content="summary"><meta name=twitter:title content="Serverless Codeigniter 4"><meta name=twitter:description content="Serverless has been very popular for several years now. When we need very high performance it can be a very good alternative to traditional server solutions. Therefore, this time we will try to run CodeIgniter 4 in a serverless environment."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://michalsn.dev/posts/"},{"@type":"ListItem","position":2,"name":"Serverless Codeigniter 4","item":"https://michalsn.dev/posts/serverless-codeigniter-4/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Serverless Codeigniter 4","name":"Serverless Codeigniter 4","description":"Serverless has been very popular for several years now. When we need very high performance it can be a very good alternative to traditional server solutions. Therefore, this time we will try to run CodeIgniter 4 in a serverless environment.\n","keywords":["serverless","bref","aws","codeigniter4"],"articleBody":"Serverless has been very popular for several years now. When we need very high performance it can be a very good alternative to traditional server solutions. Therefore, this time we will try to run CodeIgniter 4 in a serverless environment.\nInstallation The first thing to do is to install the Serverless framework (if you don’t already have it). You can read how to do that here: https://bref.sh/docs/installation.html\nFollow all the steps from the “Serverless” section and come back here.\nIf we already have the Serverless Framework installed and an AWS account configured, we can move on. Let’s create a sample project in CodeIgniter 4:\ncomposer create-project codeigniter4/appstarter serverless-ci4 Inside our project, let’s install bref, which will allow us to easily run our PHP project on Lambda function.\ncomposer require bref/bref Let’s initiate the project.\nvendor/bin/bref init And select the 0 option when asked about the type of apllication.\nConfiguration First things first. We should adjust the serverless.yaml file to our needs:\nservice: serverless-codeigniter4 provider: name: aws region: eu-central-1 runtime: provided.al2 memorySize: 512 plugins: - ./vendor/bref/bref functions: api: handler: public/index.php # point us to the CodeIgniter's index.php file description: '' timeout: 28 # in seconds (API Gateway has a timeout of 29 seconds) layers: - ${bref:layer.php-81-fpm} events: - httpApi: '*' # Exclude files from deployment package: patterns: - '!node_modules/**' - '!tests/**' Now we can move on. CodeIgniter 4 requires the Intl extension. By default, this extension is disabled, so we need to enable it. To do this, we need to create a php.ini file that will be loaded when the instance is launched.\nIn the root directory of our project, let’s create the following path/file: php/conf.d/php.ini with the contents:\nextension=intl Let’s move on to CodeIgniter’s configuration settings, because there are a few things we need to change. Let’s create a copy of the env file under the name .env. Now let’s edit the value for CI_ENVIRONMENT and few others.\nCI_ENVIRONMENT = development app.indexPage = '' app.uriProtocol = 'PATH_INFO'; We change the CI_ENVIRONMENT just in case something goes wrong, so we can see the errors. Later we will go back to the production value. The change for the uriProtocol is necessary so the Lambda could recognize our routing.\nNext, we need to overwrite the paths for the session (if we will use it) and cache files. In the following example we assume that we use a file handler for both the session and cache files.\n// app/Config/Registrar.php namespace App\\Config; use RuntimeException; class Registrar { public static function App() { $isLambda = isset($_SERVER['LAMBDA_TASK_ROOT']); if ($isLambda) { $sessionPathDir = '/tmp/session'; if (! is_dir($sessionPathDir)) { if (! mkdir($sessionPathDir, 0755, true) \u0026\u0026 ! is_dir($sessionPathDir)) { throw new RuntimeException(sprintf('Directory \"%s\" cannot be created', $sessionPathDir)); } } return [ 'sessionSavePath' =\u003e $sessionPathDir, ]; } return []; } public static function Cache() { $isLambda = isset($_SERVER['LAMBDA_TASK_ROOT']); if ($isLambda) { $cachePathDir = '/tmp/cache'; if (! is_dir($cachePathDir)) { if (! mkdir($cachePathDir, 0755, true) \u0026\u0026 ! is_dir($cachePathDir)) { throw new RuntimeException(sprintf('Directory \"%s\" cannot be created', $cachePathDir)); } } return [ 'file' =\u003e [ 'storePath' =\u003e $cachePathDir ], ]; } return []; } } The last point will be to change the logging method so that the logs are available in CloudWatch. To do this, we will install a simple extension that will replace our default logger.\ncomposer require bref/logger Let’s edit the Services.php file to start using the new logger.\n// app/Config/Services.php namespace Config; use CodeIgniter\\Config\\BaseService; use Bref\\Logger\\StderrLogger; class Services extends BaseService { /** * The Logger class is a PSR-3 compatible Logging class that supports * multiple handlers that process the actual logging. * * @return StderrLogger */ public static function logger(bool $getShared = true) { if ($getShared) { return static::getSharedInstance('logger'); } return new StderrLogger(); } } We can now upload our project. The first time deploy may take about 2 minutes.\nserverless deploy After navigating to the address that will be displayed to us in the console, we should see the standard landing page of CodeIgniter 4.\nThe last thing we should do is to update the CI_ENVIRONMENT and baseURL variables in the .env file:\nCI_ENVIRONMENT = production app.baseURL = 'https://out-instance-number.execute-api.eu-central-1.amazonaws.com' The value for baseURL should be the value displayed to us after deployment in the console.\nNow we should call serverless deploy one more time and we are all set.\nOf course, usually we won’t be serving entire websites, but rather providing an API. But if we come to run a full-fledged website, we should remember not to serve the static files through the Lambda function.\nFortunately, there are built-in solutions for this. I encourage you to study the documentation: https://bref.sh/docs/.\nThat would be it. We have a CodeIgniter 4 application served through the Lambda function - in other words: Serverless CodeIgniter 4.\n","wordCount":"784","inLanguage":"en","datePublished":"2022-07-07T18:24:14+02:00","dateModified":"2022-07-07T18:24:14+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://michalsn.dev/posts/serverless-codeigniter-4/"},"publisher":{"@type":"Organization","name":"michalsn","logo":{"@type":"ImageObject","url":"https://michalsn.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://michalsn.dev/ accesskey=h title="michalsn (Alt + H)">michalsn</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://michalsn.dev/archives title=Archive><span>Archive</span></a></li><li><a href=https://michalsn.dev/tags title=Tags><span>Tags</span></a></li><li><a href=https://michalsn.dev/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Serverless Codeigniter 4</h1><div class=post-meta>July 7, 2022&nbsp;·&nbsp;4 min</div></header><div class=post-content><p>Serverless has been very popular for several years now. When we need very high performance it can be a very good alternative to traditional server solutions. Therefore, this time we will try to run CodeIgniter 4 in a serverless environment.</p><h3 id=installation>Installation<a hidden class=anchor aria-hidden=true href=#installation>#</a></h3><p>The first thing to do is to install the Serverless framework (if you don&rsquo;t already have it). You can read how to do that here: <a href=https://bref.sh/docs/installation.html>https://bref.sh/docs/installation.html</a></p><p>Follow all the steps from the &ldquo;Serverless&rdquo; section and come back here.</p><p>If we already have the Serverless Framework installed and an AWS account configured, we can move on. Let&rsquo;s create a sample project in CodeIgniter 4:</p><pre tabindex=0><code class=language-cli data-lang=cli>composer create-project codeigniter4/appstarter serverless-ci4
</code></pre><p>Inside our project, let&rsquo;s install <code>bref</code>, which will allow us to easily run our PHP project on Lambda function.</p><pre tabindex=0><code class=language-cli data-lang=cli>composer require bref/bref
</code></pre><p>Let&rsquo;s initiate the project.</p><pre tabindex=0><code>vendor/bin/bref init
</code></pre><p>And select the <code>0</code> option when asked about the type of apllication.</p><h3 id=configuration>Configuration<a hidden class=anchor aria-hidden=true href=#configuration>#</a></h3><p>First things first. We should adjust the <code>serverless.yaml</code> file to our needs:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>service</span>: <span style=color:#ae81ff>serverless-codeigniter4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>provider</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>region</span>: <span style=color:#ae81ff>eu-central-1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>runtime</span>: <span style=color:#ae81ff>provided.al2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>memorySize</span>: <span style=color:#ae81ff>512</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>plugins</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>./vendor/bref/bref</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>functions</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>api</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>handler</span>: <span style=color:#ae81ff>public/index.php</span> <span style=color:#75715e># point us to the CodeIgniter&#39;s index.php file</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>description</span>: <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>timeout</span>: <span style=color:#ae81ff>28</span> <span style=color:#75715e># in seconds (API Gateway has a timeout of 29 seconds)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>layers</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>${bref:layer.php-81-fpm}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>events</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>httpApi</span>: <span style=color:#e6db74>&#39;*&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Exclude files from deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>patterns</span>:
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#39;!node_modules/**&#39;</span>
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#39;!tests/**&#39;</span>
</span></span></code></pre></div><p>Now we can move on. CodeIgniter 4 requires the <code>Intl</code> extension. By default, this extension is disabled, so we need to enable it.
To do this, we need to create a <code>php.ini</code> file that will be loaded when the instance is launched.</p><p>In the root directory of our project, let&rsquo;s create the following path/file: <code>php/conf.d/php.ini</code> with the contents:</p><pre tabindex=0><code>extension=intl
</code></pre><p>Let&rsquo;s move on to CodeIgniter&rsquo;s configuration settings, because there are a few things we need to change.
Let&rsquo;s create a copy of the <code>env</code> file under the name <code>.env</code>. Now let&rsquo;s edit the value for <code>CI_ENVIRONMENT</code> and few others.</p><pre tabindex=0><code class=language-cli data-lang=cli>CI_ENVIRONMENT = development

app.indexPage = &#39;&#39;
app.uriProtocol = &#39;PATH_INFO&#39;;
</code></pre><p>We change the <code>CI_ENVIRONMENT</code> just in case something goes wrong, so we can see the errors. Later we will go back to the <code>production</code> value.
The change for the <code>uriProtocol</code> is necessary so the Lambda could recognize our routing.</p><p>Next, we need to overwrite the paths for the <code>session</code> (if we will use it) and <code>cache</code> files. In the following example
we assume that we use a file handler for both the session and cache files.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// app/Config/Registrar.php
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>App\Config</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>RuntimeException</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Registrar</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>App</span>()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $isLambda <span style=color:#f92672>=</span> <span style=color:#a6e22e>isset</span>($_SERVER[<span style=color:#e6db74>&#39;LAMBDA_TASK_ROOT&#39;</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($isLambda) {
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            $sessionPathDir <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;/tmp/session&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span> <span style=color:#a6e22e>is_dir</span>($sessionPathDir)) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span> <span style=color:#a6e22e>mkdir</span>($sessionPathDir, <span style=color:#ae81ff>0755</span>, <span style=color:#66d9ef>true</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span> <span style=color:#a6e22e>is_dir</span>($sessionPathDir)) {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RuntimeException</span>(<span style=color:#a6e22e>sprintf</span>(<span style=color:#e6db74>&#39;Directory &#34;%s&#34; cannot be created&#39;</span>, $sessionPathDir));
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;sessionSavePath&#39;</span> <span style=color:#f92672>=&gt;</span> $sessionPathDir,
</span></span><span style=display:flex><span>            ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> [];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>Cache</span>()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $isLambda <span style=color:#f92672>=</span> <span style=color:#a6e22e>isset</span>($_SERVER[<span style=color:#e6db74>&#39;LAMBDA_TASK_ROOT&#39;</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($isLambda) {
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            $cachePathDir <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;/tmp/cache&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span> <span style=color:#a6e22e>is_dir</span>($cachePathDir)) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span> <span style=color:#a6e22e>mkdir</span>($cachePathDir, <span style=color:#ae81ff>0755</span>, <span style=color:#66d9ef>true</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span> <span style=color:#a6e22e>is_dir</span>($cachePathDir)) {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RuntimeException</span>(<span style=color:#a6e22e>sprintf</span>(<span style=color:#e6db74>&#39;Directory &#34;%s&#34; cannot be created&#39;</span>, $cachePathDir));
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;file&#39;</span> <span style=color:#f92672>=&gt;</span> [
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;storePath&#39;</span> <span style=color:#f92672>=&gt;</span> $cachePathDir
</span></span><span style=display:flex><span>                ],
</span></span><span style=display:flex><span>            ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> [];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The last point will be to change the logging method so that the logs are available in <code>CloudWatch</code>.
To do this, we will install a simple extension that will replace our default logger.</p><pre tabindex=0><code class=language-cli data-lang=cli>composer require bref/logger
</code></pre><p>Let&rsquo;s edit the <code>Services.php</code> file to start using the new logger.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// app/Config/Services.php
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>Config</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>CodeIgniter\Config\BaseService</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Bref\Logger\StderrLogger</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Services</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>BaseService</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#e6db74>/**
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     * The Logger class is a PSR-3 compatible Logging class that supports
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     * multiple handlers that process the actual logging.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     *
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     * @return StderrLogger
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>logger</span>(<span style=color:#a6e22e>bool</span> $getShared <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($getShared) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>static</span><span style=color:#f92672>::</span><span style=color:#a6e22e>getSharedInstance</span>(<span style=color:#e6db74>&#39;logger&#39;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>StderrLogger</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>We can now upload our project. The first time deploy may take about 2 minutes.</p><pre tabindex=0><code>serverless deploy
</code></pre><p>After navigating to the address that will be displayed to us in the console, we should see the standard landing page of CodeIgniter 4.</p><p>The last thing we should do is to update the <code>CI_ENVIRONMENT</code> and <code>baseURL</code> variables in the <code>.env</code> file:</p><pre tabindex=0><code class=language-cli data-lang=cli>CI_ENVIRONMENT = production

app.baseURL = &#39;https://out-instance-number.execute-api.eu-central-1.amazonaws.com&#39;
</code></pre><p>The value for <code>baseURL</code> should be the value displayed to us after deployment in the console.</p><p>Now we should call <code>serverless deploy</code> one more time and we are all set.</p><p>Of course, usually we won&rsquo;t be serving entire websites, but rather providing an API.
But if we come to run a full-fledged website, we should remember not to serve the static files through the Lambda function.</p><p>Fortunately, there are built-in solutions for this. I encourage you to study the documentation: <a href=https://bref.sh/docs/>https://bref.sh/docs/</a>.</p><p>That would be it. We have a CodeIgniter 4 application served through the Lambda function - in other words: Serverless CodeIgniter 4.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://michalsn.dev/tags/serverless/>serverless</a></li><li><a href=https://michalsn.dev/tags/bref/>bref</a></li><li><a href=https://michalsn.dev/tags/aws/>aws</a></li><li><a href=https://michalsn.dev/tags/codeigniter4/>codeigniter4</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://michalsn.dev/>michalsn</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>