<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Serverless Codeigniter 4 | michalsn</title><meta name=keywords content="serverless,bref,aws,codeigniter4"><meta name=description content="Serverless has been very popular for several years now. When we need very high performance it can be a very good alternative to traditional server solutions. Therefore, this time we will try to run CodeIgniter 4 in a serverless environment."><meta name=author content><link rel=canonical href=https://michalsn.dev/posts/serverless-codeigniter-4/><link crossorigin=anonymous href=/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css integrity="sha256-NDzEgLn/yPBMy+XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as=style><link rel=icon href=https://michalsn.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://michalsn.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://michalsn.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://michalsn.dev/apple-touch-icon.png><link rel=mask-icon href=https://michalsn.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://michalsn.dev/posts/serverless-codeigniter-4/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><link rel=stylesheet href=/css/custom.css><script src=/js/custom.js></script><meta property="og:url" content="https://michalsn.dev/posts/serverless-codeigniter-4/"><meta property="og:site_name" content="michalsn"><meta property="og:title" content="Serverless Codeigniter 4"><meta property="og:description" content="Serverless has been very popular for several years now. When we need very high performance it can be a very good alternative to traditional server solutions. Therefore, this time we will try to run CodeIgniter 4 in a serverless environment."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-07T18:24:14+02:00"><meta property="article:modified_time" content="2022-07-07T18:24:14+02:00"><meta property="article:tag" content="Serverless"><meta property="article:tag" content="Bref"><meta property="article:tag" content="Aws"><meta property="article:tag" content="Codeigniter4"><meta property="og:image" content="https://michalsn.dev/posts/serverless-codeigniter-4/og.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://michalsn.dev/posts/serverless-codeigniter-4/og.png"><meta name=twitter:title content="Serverless Codeigniter 4"><meta name=twitter:description content="Serverless has been very popular for several years now. When we need very high performance it can be a very good alternative to traditional server solutions. Therefore, this time we will try to run CodeIgniter 4 in a serverless environment."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://michalsn.dev/posts/"},{"@type":"ListItem","position":2,"name":"Serverless Codeigniter 4","item":"https://michalsn.dev/posts/serverless-codeigniter-4/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Serverless Codeigniter 4","name":"Serverless Codeigniter 4","description":"Serverless has been very popular for several years now. When we need very high performance it can be a very good alternative to traditional server solutions. Therefore, this time we will try to run CodeIgniter 4 in a serverless environment.\n","keywords":["serverless","bref","aws","codeigniter4"],"articleBody":"Serverless has been very popular for several years now. When we need very high performance it can be a very good alternative to traditional server solutions. Therefore, this time we will try to run CodeIgniter 4 in a serverless environment.\nInstallation The first thing to do is to install the Serverless framework (if you don’t already have it). You can read how to do that here: https://bref.sh/docs/installation.html\nFollow all the steps from the “Serverless” section and come back here.\nIf we already have the Serverless Framework installed and an AWS account configured, we can move on. Let’s create a sample project in CodeIgniter 4:\ncomposer create-project codeigniter4/appstarter serverless-ci4 Inside our project, let’s install bref, which will allow us to easily run our PHP project on Lambda function.\ncomposer require bref/bref Let’s initiate the project.\nvendor/bin/bref init And select the 0 option when asked about the type of apllication.\nConfiguration First things first. We should adjust the serverless.yaml file to our needs:\nservice: serverless-codeigniter4 provider: name: aws region: eu-central-1 runtime: provided.al2 memorySize: 512 plugins: - ./vendor/bref/bref functions: api: handler: public/index.php # point us to the CodeIgniter's index.php file description: '' timeout: 28 # in seconds (API Gateway has a timeout of 29 seconds) layers: - ${bref:layer.php-81-fpm} events: - httpApi: '*' # Exclude files from deployment package: patterns: - '!node_modules/**' - '!tests/**' Now we can move on. CodeIgniter 4 requires the Intl extension. By default, this extension is disabled, so we need to enable it. To do this, we need to create a php.ini file that will be loaded when the instance is launched.\nIn the root directory of our project, let’s create the following path/file: php/conf.d/php.ini with the contents:\nextension=intl Let’s move on to CodeIgniter’s configuration settings, because there are a few things we need to change. Let’s create a copy of the env file under the name .env. Now let’s edit the value for CI_ENVIRONMENT and few others.\nCI_ENVIRONMENT = development app.indexPage = '' app.uriProtocol = 'PATH_INFO'; We change the CI_ENVIRONMENT just in case something goes wrong, so we can see the errors. Later we will go back to the production value. The change for the uriProtocol is necessary so the Lambda could recognize our routing.\nNext, we need to overwrite the paths for the session (if we will use it) and cache files. In the following example we assume that we use a file handler for both the session and cache files.\n// app/Config/Registrar.php namespace App\\Config; use RuntimeException; class Registrar { public static function App() { $isLambda = isset($_SERVER['LAMBDA_TASK_ROOT']); if ($isLambda) { $sessionPathDir = '/tmp/session'; if (! is_dir($sessionPathDir)) { if (! mkdir($sessionPathDir, 0755, true) \u0026\u0026 ! is_dir($sessionPathDir)) { throw new RuntimeException(sprintf('Directory \"%s\" cannot be created', $sessionPathDir)); } } return [ 'sessionSavePath' =\u003e $sessionPathDir, ]; } return []; } public static function Cache() { $isLambda = isset($_SERVER['LAMBDA_TASK_ROOT']); if ($isLambda) { $cachePathDir = '/tmp/cache'; if (! is_dir($cachePathDir)) { if (! mkdir($cachePathDir, 0755, true) \u0026\u0026 ! is_dir($cachePathDir)) { throw new RuntimeException(sprintf('Directory \"%s\" cannot be created', $cachePathDir)); } } return [ 'file' =\u003e [ 'storePath' =\u003e $cachePathDir ], ]; } return []; } } The last point will be to change the logging method so that the logs are available in CloudWatch. To do this, we will install a simple extension that will replace our default logger.\ncomposer require bref/logger Let’s edit the Services.php file to start using the new logger.\n// app/Config/Services.php namespace Config; use CodeIgniter\\Config\\BaseService; use Bref\\Logger\\StderrLogger; class Services extends BaseService { /** * The Logger class is a PSR-3 compatible Logging class that supports * multiple handlers that process the actual logging. * * @return StderrLogger */ public static function logger(bool $getShared = true) { if ($getShared) { return static::getSharedInstance('logger'); } return new StderrLogger(); } } We can now upload our project. The first time deploy may take about 2 minutes.\nserverless deploy After navigating to the address that will be displayed to us in the console, we should see the standard landing page of CodeIgniter 4.\nThe last thing we should do is to update the CI_ENVIRONMENT and baseURL variables in the .env file:\nCI_ENVIRONMENT = production app.baseURL = 'https://out-instance-number.execute-api.eu-central-1.amazonaws.com' The value for baseURL should be the value displayed to us after deployment in the console.\nNow we should call serverless deploy one more time and we are all set.\nOf course, usually we won’t be serving entire websites, but rather providing an API. But if we come to run a full-fledged website, we should remember not to serve the static files through the Lambda function.\nFortunately, there are built-in solutions for this. I encourage you to study the documentation: https://bref.sh/docs/.\nThat would be it. We have a CodeIgniter 4 application served through the Lambda function - in other words: Serverless CodeIgniter 4.\n","wordCount":"784","inLanguage":"en","datePublished":"2022-07-07T18:24:14+02:00","dateModified":"2022-07-07T18:24:14+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://michalsn.dev/posts/serverless-codeigniter-4/"},"publisher":{"@type":"Organization","name":"michalsn","logo":{"@type":"ImageObject","url":"https://michalsn.dev/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://michalsn.dev/ accesskey=h title="michalsn (Alt + H)">michalsn</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://michalsn.dev/projects title=Projects><span>Projects</span></a></li><li><a href=https://michalsn.dev/archives title=Archive><span>Archive</span></a></li><li><a href=https://michalsn.dev/tags title=Tags><span>Tags</span></a></li><li><a href=https://michalsn.dev/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Serverless Codeigniter 4</h1><div class=post-meta><span title='2022-07-07 18:24:14 +0200 +0200'>July 7, 2022</span>&nbsp;·&nbsp;<span>4 min</span></div></header><div class=post-content><p>Serverless has been very popular for several years now. When we need very high performance it can be a very good alternative to traditional server solutions. Therefore, this time we will try to run CodeIgniter 4 in a serverless environment.</p><h3 id=installation>Installation<a hidden class=anchor aria-hidden=true href=#installation>#</a></h3><p>The first thing to do is to install the Serverless framework (if you don&rsquo;t already have it). You can read how to do that here: <a href=https://bref.sh/docs/installation.html>https://bref.sh/docs/installation.html</a></p><p>Follow all the steps from the &ldquo;Serverless&rdquo; section and come back here.</p><p>If we already have the Serverless Framework installed and an AWS account configured, we can move on. Let&rsquo;s create a sample project in CodeIgniter 4:</p><pre tabindex=0><code class=language-cli data-lang=cli>composer create-project codeigniter4/appstarter serverless-ci4
</code></pre><p>Inside our project, let&rsquo;s install <code>bref</code>, which will allow us to easily run our PHP project on Lambda function.</p><pre tabindex=0><code class=language-cli data-lang=cli>composer require bref/bref
</code></pre><p>Let&rsquo;s initiate the project.</p><pre tabindex=0><code>vendor/bin/bref init
</code></pre><p>And select the <code>0</code> option when asked about the type of apllication.</p><h3 id=configuration>Configuration<a hidden class=anchor aria-hidden=true href=#configuration>#</a></h3><p>First things first. We should adjust the <code>serverless.yaml</code> file to our needs:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>service</span>: <span style=color:#ae81ff>serverless-codeigniter4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>provider</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>region</span>: <span style=color:#ae81ff>eu-central-1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>runtime</span>: <span style=color:#ae81ff>provided.al2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>memorySize</span>: <span style=color:#ae81ff>512</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>plugins</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>./vendor/bref/bref</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>functions</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>api</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>handler</span>: <span style=color:#ae81ff>public/index.php</span> <span style=color:#75715e># point us to the CodeIgniter&#39;s index.php file</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>description</span>: <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>timeout</span>: <span style=color:#ae81ff>28</span> <span style=color:#75715e># in seconds (API Gateway has a timeout of 29 seconds)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>layers</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>${bref:layer.php-81-fpm}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>events</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>httpApi</span>: <span style=color:#e6db74>&#39;*&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Exclude files from deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>patterns</span>:
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#39;!node_modules/**&#39;</span>
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#39;!tests/**&#39;</span>
</span></span></code></pre></div><p>Now we can move on. CodeIgniter 4 requires the <code>Intl</code> extension. By default, this extension is disabled, so we need to enable it.
To do this, we need to create a <code>php.ini</code> file that will be loaded when the instance is launched.</p><p>In the root directory of our project, let&rsquo;s create the following path/file: <code>php/conf.d/php.ini</code> with the contents:</p><pre tabindex=0><code>extension=intl
</code></pre><p>Let&rsquo;s move on to CodeIgniter&rsquo;s configuration settings, because there are a few things we need to change.
Let&rsquo;s create a copy of the <code>env</code> file under the name <code>.env</code>. Now let&rsquo;s edit the value for <code>CI_ENVIRONMENT</code> and few others.</p><pre tabindex=0><code class=language-cli data-lang=cli>CI_ENVIRONMENT = development

app.indexPage = &#39;&#39;
app.uriProtocol = &#39;PATH_INFO&#39;;
</code></pre><p>We change the <code>CI_ENVIRONMENT</code> just in case something goes wrong, so we can see the errors. Later we will go back to the <code>production</code> value.
The change for the <code>uriProtocol</code> is necessary so the Lambda could recognize our routing.</p><p>Next, we need to overwrite the paths for the <code>session</code> (if we will use it) and <code>cache</code> files. In the following example
we assume that we use a file handler for both the session and cache files.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// app/Config/Registrar.php
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>App\Config</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>RuntimeException</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Registrar</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>App</span>()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $isLambda <span style=color:#f92672>=</span> <span style=color:#a6e22e>isset</span>($_SERVER[<span style=color:#e6db74>&#39;LAMBDA_TASK_ROOT&#39;</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($isLambda) {
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            $sessionPathDir <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;/tmp/session&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span> <span style=color:#a6e22e>is_dir</span>($sessionPathDir)) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span> <span style=color:#a6e22e>mkdir</span>($sessionPathDir, <span style=color:#ae81ff>0755</span>, <span style=color:#66d9ef>true</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span> <span style=color:#a6e22e>is_dir</span>($sessionPathDir)) {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RuntimeException</span>(<span style=color:#a6e22e>sprintf</span>(<span style=color:#e6db74>&#39;Directory &#34;%s&#34; cannot be created&#39;</span>, $sessionPathDir));
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;sessionSavePath&#39;</span> <span style=color:#f92672>=&gt;</span> $sessionPathDir,
</span></span><span style=display:flex><span>            ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> [];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>Cache</span>()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $isLambda <span style=color:#f92672>=</span> <span style=color:#a6e22e>isset</span>($_SERVER[<span style=color:#e6db74>&#39;LAMBDA_TASK_ROOT&#39;</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($isLambda) {
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            $cachePathDir <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;/tmp/cache&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span> <span style=color:#a6e22e>is_dir</span>($cachePathDir)) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span> <span style=color:#a6e22e>mkdir</span>($cachePathDir, <span style=color:#ae81ff>0755</span>, <span style=color:#66d9ef>true</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span> <span style=color:#a6e22e>is_dir</span>($cachePathDir)) {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RuntimeException</span>(<span style=color:#a6e22e>sprintf</span>(<span style=color:#e6db74>&#39;Directory &#34;%s&#34; cannot be created&#39;</span>, $cachePathDir));
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;file&#39;</span> <span style=color:#f92672>=&gt;</span> [
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;storePath&#39;</span> <span style=color:#f92672>=&gt;</span> $cachePathDir
</span></span><span style=display:flex><span>                ],
</span></span><span style=display:flex><span>            ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> [];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The last point will be to change the logging method so that the logs are available in <code>CloudWatch</code>.
To do this, we will install a simple extension that will replace our default logger.</p><pre tabindex=0><code class=language-cli data-lang=cli>composer require bref/logger
</code></pre><p>Let&rsquo;s edit the <code>Services.php</code> file to start using the new logger.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// app/Config/Services.php
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>Config</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>CodeIgniter\Config\BaseService</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Bref\Logger\StderrLogger</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Services</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>BaseService</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#e6db74>/**
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     * The Logger class is a PSR-3 compatible Logging class that supports
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     * multiple handlers that process the actual logging.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     *
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     * @return StderrLogger
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>logger</span>(<span style=color:#a6e22e>bool</span> $getShared <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($getShared) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>static</span><span style=color:#f92672>::</span><span style=color:#a6e22e>getSharedInstance</span>(<span style=color:#e6db74>&#39;logger&#39;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>StderrLogger</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>We can now upload our project. The first time deploy may take about 2 minutes.</p><pre tabindex=0><code>serverless deploy
</code></pre><p>After navigating to the address that will be displayed to us in the console, we should see the standard landing page of CodeIgniter 4.</p><p>The last thing we should do is to update the <code>CI_ENVIRONMENT</code> and <code>baseURL</code> variables in the <code>.env</code> file:</p><pre tabindex=0><code class=language-cli data-lang=cli>CI_ENVIRONMENT = production

app.baseURL = &#39;https://out-instance-number.execute-api.eu-central-1.amazonaws.com&#39;
</code></pre><p>The value for <code>baseURL</code> should be the value displayed to us after deployment in the console.</p><p>Now we should call <code>serverless deploy</code> one more time and we are all set.</p><p>Of course, usually we won&rsquo;t be serving entire websites, but rather providing an API.
But if we come to run a full-fledged website, we should remember not to serve the static files through the Lambda function.</p><p>Fortunately, there are built-in solutions for this. I encourage you to study the documentation: <a href=https://bref.sh/docs/>https://bref.sh/docs/</a>.</p><p>That would be it. We have a CodeIgniter 4 application served through the Lambda function - in other words: Serverless CodeIgniter 4.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://michalsn.dev/tags/serverless/>Serverless</a></li><li><a href=https://michalsn.dev/tags/bref/>Bref</a></li><li><a href=https://michalsn.dev/tags/aws/>Aws</a></li><li><a href=https://michalsn.dev/tags/codeigniter4/>Codeigniter4</a></li></ul><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Serverless Codeigniter 4 on x" href="https://x.com/intent/tweet/?text=Serverless%20Codeigniter%204&amp;url=https%3a%2f%2fmichalsn.dev%2fposts%2fserverless-codeigniter-4%2f&amp;hashtags=serverless%2cbref%2caws%2ccodeigniter4"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Serverless Codeigniter 4 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fmichalsn.dev%2fposts%2fserverless-codeigniter-4%2f&amp;title=Serverless%20Codeigniter%204&amp;summary=Serverless%20Codeigniter%204&amp;source=https%3a%2f%2fmichalsn.dev%2fposts%2fserverless-codeigniter-4%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Serverless Codeigniter 4 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fmichalsn.dev%2fposts%2fserverless-codeigniter-4%2f&title=Serverless%20Codeigniter%204"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Serverless Codeigniter 4 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmichalsn.dev%2fposts%2fserverless-codeigniter-4%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Serverless Codeigniter 4 on whatsapp" href="https://api.whatsapp.com/send?text=Serverless%20Codeigniter%204%20-%20https%3a%2f%2fmichalsn.dev%2fposts%2fserverless-codeigniter-4%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Serverless Codeigniter 4 on telegram" href="https://telegram.me/share/url?text=Serverless%20Codeigniter%204&amp;url=https%3a%2f%2fmichalsn.dev%2fposts%2fserverless-codeigniter-4%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Serverless Codeigniter 4 on ycombinator" href="https://news.ycombinator.com/submitlink?t=Serverless%20Codeigniter%204&u=https%3a%2f%2fmichalsn.dev%2fposts%2fserverless-codeigniter-4%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><script src=https://utteranc.es/client.js repo=michalsn/michalsn.dev issue-term=pathname label=comments theme=preferred-color-scheme crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2026 <a href=https://michalsn.dev/>michalsn</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg></a><div id=cookie-notice role=dialog aria-live=polite aria-label="Cookie notice"><div class=inner><span>This website uses third-party cookies and scripts to improve its functionality.</span>
<a id=cookie-notice-accept class="btn btn-primary btn-sm">Approve</a>
<a id=cookie-notice-deny class="btn btn-primary btn-sm">Deny</a>
<a id=cookie-notice-info href=/privacy class="btn btn-primary btn-sm">More info</a></div></div><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>